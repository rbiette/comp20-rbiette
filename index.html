<!--

	
	MY username: dxBYx83s
	cd desktop/School/College/Junior/"Comp 20"/comp20-rbiette/landmarks
	KEY: AIzaSyCmK2muARSuCGRnKpIsuo8uIttRY5Btjfg
	
	- make the page a map (done)

	- retreive location of me by navigator.geolocation (done)

	- send location to datastore(done)

	- retrieve locations of other people/landmarks within a mile
	
	- display people's locations with unique marker(done)
		-on click -> display location and login
	- display landmarks on map with unique marker(done)
		- on click -> landmark details will pop up
	- displays my location on the map with a different image(done)
		- on click -> display closest landmark name

		- make a polyline to that landmark 


    "<div>id=title</div><br>" + "<div>id=website</div><br>" + "<div>id=login</div><br>" + "<div>id=distance</div><br>";
-->
<!DOCTYPE html>
<html>
  <head>
    <title>Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" href= "mapstyle.css"/>

    <script>
      var map;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 42.406, lng: -71.116},
          zoom: 14
        });
      }

// get location 

    	var myLat = -9999;
    	var myLong = -9999;
    	function getLocation() {
    			if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
    				myLat = position.coords.latitude;
    				myLong = position.coords.longitude;
            sendData();
    			})
        }
        else
          alert("Oh no! Geolocation is not supported on your browser");
    	}
//distance function (given two points, return distance in miles)
function distance(lat2,lon2,lat1,lon1){
  Number.prototype.toRad = function() {
   return this * Math.PI / 180;
}
  var R = 6371; // km 
  var x1 = lat2-lat1;
  var dLat = x1.toRad();  
  var x2 = lon2-lon1;
  var dLon = x2.toRad();  
  var a = Math.sin(dLat/2) * Math.sin(dLat/2) + 
                Math.cos(lat1.toRad()) * Math.cos(lat2.toRad()) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);  
  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
  var d = (R * c)/1.609; //where d is distance in miles
}
console.log(distance(myLat,myLong,myLat,myLong));


//Send data
     function sendData() {
      request = new XMLHttpRequest();
      request.open("POST", "https://defense-in-derpth.herokuapp.com/sendLocation/", true);
        request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        request.onreadystatechange = function() {
          if(request.readyState == 4 && request.status == 200) {
            var rawData = request.responseText;
            var cleanData = JSON.parse(rawData);

console.log(cleanData);

            //Make marker for me(NEED TO ADD CLOSEST LANDMARK TO ME!!!)
            var image1 = "mark_er1.png"; //Hee hee it's "Mark" Wahlberg
            var marker1 = new google.maps.Marker({
              position: {lat: myLat, lng: myLong},
              map: map,
              icon: image1
            }); 
//Make info window for me
            var contentString = "<h3>login = dxBYx83s</h3>" + "<p>Closest Landmark: </p>" + "<p>Distance = </p>";
//Come back for calculating nearest landmark and putting it in here
            var infoWindow = new google.maps.InfoWindow()
            google.maps.event.addListener(marker1,'click', function() { 
              infoWindow.setContent(contentString);
              infoWindow.open(map, this);
              });
   

            //people markers
            for (var i = 0; i < cleanData.people.length; i++) {
var contentString1 = "<h4>login = " + cleanData.people[i].login + "</h4>" + "<p>Distance from me = " + "" + "</p>";
              //make a marker for people
              var image2 = "mark_er2.png"; //Hee hee it's "Mark" Zuckerberg 
              marker2 = new google.maps.Marker({
              position: {lat: cleanData.people[i].lat, lng: cleanData.people[i].lng},
              map: map,
              content: contentString1,
              icon: image2
            }); 

              var infoWindow1 = new google.maps.InfoWindow() 
              google.maps.event.addListener(marker2,'click', function() { 
                infoWindow.setContent(this.content);
                infoWindow.open(map, this);
              });
           }



            for (var j = 0; j < cleanData.landmarks.length; j++){
              var contentString2 = "<h4>Site = " + cleanData.landmarks[j].properties.Location_Name + "</h4>" + cleanData.landmarks[j].properties.Details;

//              if (distance(myLat,myLong,cleanData.landmarks[j].geometry.coordinates[1],cleanData.landmarks[j].geometry.coordinates[0]) < 1){
                var image3 = "mark_er3.png"; //Hee hee it's mark ruffalo
                var marker3 = new google.maps.Marker({
                position: {lat: cleanData.landmarks[j].geometry.coordinates[1], lng: cleanData.landmarks[j].geometry.coordinates[0]},
                map: map,
                content: contentString2,
                icon: image3
                });

                var infoWindow = new google.maps.InfoWindow()
                google.maps.event.addListener(marker3,'click', function() { 
                  infoWindow.setContent(this.content);
                  infoWindow.open(map, this);
                });   
//              } 
          }
        }
      }

        request.send("login=dxBYx83s&lat=" + myLat + "&lng=" + myLong +"");
     } 



    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCmK2muARSuCGRnKpIsuo8uIttRY5Btjfg"
    async defer></script>
    
  </head>


  <body onload="getLocation(), initMap()">
    <div id="map"></div>
    <div id="location">LOCATION IS...</div>

  </body>
</html>